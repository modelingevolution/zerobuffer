// <auto-generated />
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using Xunit;
using Xunit.Abstractions;
using ModelingEvolution.Harmony.Core;
using ModelingEvolution.Harmony.Execution;
using ModelingEvolution.Harmony.ProcessManagement;
using Microsoft.Extensions.Logging.Abstractions;
using ZeroBuffer.Harmony.Tests;

namespace ZeroBuffer.Harmony.Tests.Csharp_Csharp;

public class ProcessLifecycleTests : HarmonyTestBase
{
    public ProcessLifecycleTests(ITestOutputHelper output) : base(output) { }

    #region Static Test Data
    private static readonly string Test_2_1_Writer_Crash_Detection_reader_csharp_writer_csharp_Json = @"{""TestId"":""csharp-csharp-test-2-1---writer-crash-detection"",""FeatureId"":10,""ScenarioName"":""Test 2.1 - Writer Crash Detection"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""csharp""},""Background"":[{""Type"":""Given"",""Text"":""the test mode is configured"",""Process"":null,""ProcessedText"":""the test mode is configured"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the reader is \u0027csharp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Given"",""Text"":""create buffer \u0027test-writer-crash\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Process"":""reader"",""ProcessedText"":""create buffer \u0027test-writer-crash\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027python\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""connect to buffer \u0027test-writer-crash\u0027"",""Process"":""writer"",""ProcessedText"":""connect to buffer \u0027test-writer-crash\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""write frame with data \u0027alive\u0027"",""Process"":""writer"",""ProcessedText"":""write frame with data \u0027alive\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the reader is \u0027csharp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""read frame should return \u0027alive\u0027"",""Process"":""reader"",""ProcessedText"":""read frame should return \u0027alive\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""writer should be connected"",""Process"":""reader"",""ProcessedText"":""writer should be connected"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027python\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""simulate crash"",""Process"":""writer"",""ProcessedText"":""simulate crash"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the reader is \u0027csharp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""wait for \u00272\u0027 seconds"",""Process"":""reader"",""ProcessedText"":""wait for \u00272\u0027 seconds"",""Parameters"":{}},{""Type"":""Then"",""Text"":""writer should be disconnected"",""Process"":""reader"",""ProcessedText"":""writer should be disconnected"",""Parameters"":{}},{""Type"":""Then"",""Text"":""next read should timeout or indicate writer death"",""Process"":""reader"",""ProcessedText"":""next read should timeout or indicate writer death"",""Parameters"":{}}]}";
    private static readonly string Test_2_2_Reader_Crash_Detection_reader_csharp_writer_csharp_Json = @"{""TestId"":""csharp-csharp-test-2-2---reader-crash-detection"",""FeatureId"":10,""ScenarioName"":""Test 2.2 - Reader Crash Detection"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""csharp""},""Background"":[{""Type"":""Given"",""Text"":""the test mode is configured"",""Process"":null,""ProcessedText"":""the test mode is configured"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the reader is \u0027cpp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Given"",""Text"":""create buffer \u0027test-reader-crash\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Process"":""reader"",""ProcessedText"":""create buffer \u0027test-reader-crash\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027csharp\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""connect to buffer \u0027test-reader-crash\u0027"",""Process"":""writer"",""ProcessedText"":""connect to buffer \u0027test-reader-crash\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""write frame with sequence \u00271\u0027"",""Process"":""writer"",""ProcessedText"":""write frame with sequence \u00271\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the reader is \u0027cpp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""read frame should have sequence \u00271\u0027"",""Process"":""reader"",""ProcessedText"":""read frame should have sequence \u00271\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027csharp\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""fill buffer completely"",""Process"":""writer"",""ProcessedText"":""fill buffer completely"",""Parameters"":{}},{""Type"":""When"",""Text"":""the reader is \u0027cpp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""simulate crash"",""Process"":""reader"",""ProcessedText"":""simulate crash"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the writer is \u0027csharp\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""wait for \u00272\u0027 seconds"",""Process"":""writer"",""ProcessedText"":""wait for \u00272\u0027 seconds"",""Parameters"":{}},{""Type"":""Then"",""Text"":""next write should detect reader death"",""Process"":""writer"",""ProcessedText"":""next write should detect reader death"",""Parameters"":{}}]}";
    private static readonly string Test_2_3_Reader_Replacement_After_Crash_reader_csharp_writer_csharp_Json = @"{""TestId"":""csharp-csharp-test-2-3---reader-replacement-after-crash"",""FeatureId"":10,""ScenarioName"":""Test 2.3 - Reader Replacement After Crash"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""csharp""},""Background"":[{""Type"":""Given"",""Text"":""the test mode is configured"",""Process"":null,""ProcessedText"":""the test mode is configured"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the reader is \u0027python\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Given"",""Text"":""create buffer \u0027test-reader-replace\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Process"":""reader"",""ProcessedText"":""create buffer \u0027test-reader-replace\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027csharp\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""connect to buffer \u0027test-reader-replace\u0027"",""Process"":""writer"",""ProcessedText"":""connect to buffer \u0027test-reader-replace\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""write frame with sequence \u00271\u0027"",""Process"":""writer"",""ProcessedText"":""write frame with sequence \u00271\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the reader is \u0027python\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""read frame should have sequence \u00271\u0027"",""Process"":""reader"",""ProcessedText"":""read frame should have sequence \u00271\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the reader is \u0027python\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""simulate crash"",""Process"":""reader"",""ProcessedText"":""simulate crash"",""Parameters"":{}},{""Type"":""When"",""Text"":""the reader is \u0027cpp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""connect as reader to existing buffer \u0027test-reader-replace\u0027"",""Process"":""reader"",""ProcessedText"":""connect as reader to existing buffer \u0027test-reader-replace\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027csharp\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""write frame with sequence \u00272\u0027"",""Process"":""writer"",""ProcessedText"":""write frame with sequence \u00272\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the reader is \u0027cpp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""read frame should have sequence \u00272\u0027"",""Process"":""reader"",""ProcessedText"":""read frame should have sequence \u00272\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""buffer should continue functioning normally"",""Process"":""reader"",""ProcessedText"":""buffer should continue functioning normally"",""Parameters"":{}}]}";
    private static readonly string Test_2_4_Multiple_Writer_Rejection_reader_csharp_writer_csharp_Json = @"{""TestId"":""csharp-csharp-test-2-4---multiple-writer-rejection"",""FeatureId"":10,""ScenarioName"":""Test 2.4 - Multiple Writer Rejection"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""csharp""},""Background"":[{""Type"":""Given"",""Text"":""the test mode is configured"",""Process"":null,""ProcessedText"":""the test mode is configured"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the reader is \u0027csharp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Given"",""Text"":""create buffer \u0027test-multi-writer\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Process"":""reader"",""ProcessedText"":""create buffer \u0027test-multi-writer\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027python\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""connect to buffer \u0027test-multi-writer\u0027"",""Process"":""writer"",""ProcessedText"":""connect to buffer \u0027test-multi-writer\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the writer is \u0027cpp\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""attempt to connect to buffer \u0027test-multi-writer\u0027"",""Process"":""writer"",""ProcessedText"":""attempt to connect to buffer \u0027test-multi-writer\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""connection should fail with writer exists error"",""Process"":""writer"",""ProcessedText"":""connection should fail with writer exists error"",""Parameters"":{}}]}";
    private static readonly string Test_2_5_Clean_Shutdown_Sequence_reader_csharp_writer_csharp_Json = @"{""TestId"":""csharp-csharp-test-2-5---clean-shutdown-sequence"",""FeatureId"":10,""ScenarioName"":""Test 2.5 - Clean Shutdown Sequence"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""csharp""},""Background"":[{""Type"":""Given"",""Text"":""the test mode is configured"",""Process"":null,""ProcessedText"":""the test mode is configured"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the reader is \u0027csharp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Given"",""Text"":""create buffer \u0027test-shutdown\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Process"":""reader"",""ProcessedText"":""create buffer \u0027test-shutdown\u0027 with metadata size \u00271024\u0027 and payload size \u002710240\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the writer is \u0027python\u0027"",""Process"":""writer"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""When"",""Text"":""connect to buffer \u0027test-shutdown\u0027"",""Process"":""writer"",""ProcessedText"":""connect to buffer \u0027test-shutdown\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""write frame with data \u0027final message\u0027"",""Process"":""writer"",""ProcessedText"":""write frame with data \u0027final message\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""close connection gracefully"",""Process"":""writer"",""ProcessedText"":""close connection gracefully"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the reader is \u0027csharp\u0027"",""Process"":""reader"",""ProcessedText"":"""",""Parameters"":{}},{""Type"":""Then"",""Text"":""read frame should return \u0027final message\u0027"",""Process"":""reader"",""ProcessedText"":""read frame should return \u0027final message\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""writer should be disconnected"",""Process"":""reader"",""ProcessedText"":""writer should be disconnected"",""Parameters"":{}},{""Type"":""Then"",""Text"":""reader cleanup should succeed"",""Process"":""reader"",""ProcessedText"":""reader cleanup should succeed"",""Parameters"":{}}]}";

    #endregion

    #region Scenarios Collection
    public static IEnumerable<ScenarioExecution> Scenarios => new[]
    {
        DeserializeScenarioStatic(Test_2_1_Writer_Crash_Detection_reader_csharp_writer_csharp_Json),
        DeserializeScenarioStatic(Test_2_2_Reader_Crash_Detection_reader_csharp_writer_csharp_Json),
        DeserializeScenarioStatic(Test_2_3_Reader_Replacement_After_Crash_reader_csharp_writer_csharp_Json),
        DeserializeScenarioStatic(Test_2_4_Multiple_Writer_Rejection_reader_csharp_writer_csharp_Json),
        DeserializeScenarioStatic(Test_2_5_Clean_Shutdown_Sequence_reader_csharp_writer_csharp_Json)
    };
    #endregion

    #region Test Methods
    [Fact(DisplayName = "Test 2.1 - Writer Crash Detection [reader=csharp, writer=csharp]")]
    [Trait("Scenario", "Test 2.1 - Writer Crash Detection")]
    [Trait("Platform", "csharp/csharp")]
    [Trait("Uses", "csharp")]
    [Trait("Feature", "ProcessLifecycle")]    public async Task Test_2_1_Writer_Crash_Detection_reader_csharp_writer_csharp()
    {
        var scenario = DeserializeScenario(Test_2_1_Writer_Crash_Detection_reader_csharp_writer_csharp_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 2.2 - Reader Crash Detection [reader=csharp, writer=csharp]")]
    [Trait("Scenario", "Test 2.2 - Reader Crash Detection")]
    [Trait("Platform", "csharp/csharp")]
    [Trait("Uses", "csharp")]
    [Trait("Feature", "ProcessLifecycle")]    public async Task Test_2_2_Reader_Crash_Detection_reader_csharp_writer_csharp()
    {
        var scenario = DeserializeScenario(Test_2_2_Reader_Crash_Detection_reader_csharp_writer_csharp_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 2.3 - Reader Replacement After Crash [reader=csharp, writer=csharp]")]
    [Trait("Scenario", "Test 2.3 - Reader Replacement After Crash")]
    [Trait("Platform", "csharp/csharp")]
    [Trait("Uses", "csharp")]
    [Trait("Feature", "ProcessLifecycle")]    public async Task Test_2_3_Reader_Replacement_After_Crash_reader_csharp_writer_csharp()
    {
        var scenario = DeserializeScenario(Test_2_3_Reader_Replacement_After_Crash_reader_csharp_writer_csharp_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 2.4 - Multiple Writer Rejection [reader=csharp, writer=csharp]")]
    [Trait("Scenario", "Test 2.4 - Multiple Writer Rejection")]
    [Trait("Platform", "csharp/csharp")]
    [Trait("Uses", "csharp")]
    [Trait("Feature", "ProcessLifecycle")]    public async Task Test_2_4_Multiple_Writer_Rejection_reader_csharp_writer_csharp()
    {
        var scenario = DeserializeScenario(Test_2_4_Multiple_Writer_Rejection_reader_csharp_writer_csharp_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 2.5 - Clean Shutdown Sequence [reader=csharp, writer=csharp]")]
    [Trait("Scenario", "Test 2.5 - Clean Shutdown Sequence")]
    [Trait("Platform", "csharp/csharp")]
    [Trait("Uses", "csharp")]
    [Trait("Feature", "ProcessLifecycle")]    public async Task Test_2_5_Clean_Shutdown_Sequence_reader_csharp_writer_csharp()
    {
        var scenario = DeserializeScenario(Test_2_5_Clean_Shutdown_Sequence_reader_csharp_writer_csharp_Json);
        await ExecuteScenarioAsync(scenario);
    }


    #endregion
}