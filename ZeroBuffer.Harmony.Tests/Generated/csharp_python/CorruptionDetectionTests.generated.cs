// <auto-generated />
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using Xunit;
using Xunit.Abstractions;
using ModelingEvolution.Harmony.Core;
using ModelingEvolution.Harmony.Execution;
using ModelingEvolution.Harmony.ProcessManagement;
using Microsoft.Extensions.Logging.Abstractions;
using ZeroBuffer.Harmony.Tests;

namespace ZeroBuffer.Harmony.Tests.Csharp_Python;

public class CorruptionDetectionTests : HarmonyTestBase
{
    public CorruptionDetectionTests(ITestOutputHelper output) : base(output) { }

    #region Static Test Data
    private static readonly string Test_5_1_Corrupted_OIEB_Detection_reader_csharp_writer_python_Json = @"{""TestId"":""csharp-python-test-5-1---corrupted-oieb-detection"",""FeatureId"":5,""ScenarioName"":""Test 5.1 - Corrupted OIEB Detection"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""python""},""Background"":[{""Type"":""Given"",""Text"":""the test environment is initialized"",""Process"":null,""ProcessedText"":""the test environment is initialized"",""Parameters"":{}},{""Type"":""Given"",""Text"":""all processes are ready"",""Process"":null,""ProcessedText"":""all processes are ready"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the \u0027reader\u0027 process creates buffer \u0027test-corrupt-oieb\u0027 with default config"",""Process"":""reader"",""ProcessedText"":""creates buffer \u0027test-corrupt-oieb\u0027 with default config"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process connects to buffer \u0027test-corrupt-oieb\u0027"",""Process"":""writer"",""ProcessedText"":""connects to buffer \u0027test-corrupt-oieb\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process writes frame with data \u0027valid\u0027"",""Process"":""writer"",""ProcessedText"":""writes frame with data \u0027valid\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the test corrupts OIEB field \u0027operation_size\u0027 to wrong value"",""Process"":""writer"",""ProcessedText"":""the test corrupts OIEB field \u0027operation_size\u0027 to wrong value"",""Parameters"":{}},{""Type"":""When"",""Text"":""a second \u0027writer\u0027 process attempts to connect to buffer \u0027test-corrupt-oieb\u0027"",""Process"":""writer"",""ProcessedText"":""a second \u0027writer\u0027 process attempts to connect to buffer \u0027test-corrupt-oieb\u0027"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the connection should fail with invalid OIEB error"",""Process"":""writer"",""ProcessedText"":""the connection should fail with invalid OIEB error"",""Parameters"":{}}]}";
    private static readonly string Test_5_2_Invalid_Frame_Header_Detection_reader_csharp_writer_python_Json = @"{""TestId"":""csharp-python-test-5-2---invalid-frame-header-detection"",""FeatureId"":5,""ScenarioName"":""Test 5.2 - Invalid Frame Header Detection"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""python""},""Background"":[{""Type"":""Given"",""Text"":""the test environment is initialized"",""Process"":null,""ProcessedText"":""the test environment is initialized"",""Parameters"":{}},{""Type"":""Given"",""Text"":""all processes are ready"",""Process"":null,""ProcessedText"":""all processes are ready"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the \u0027reader\u0027 process creates buffer \u0027test-invalid-header\u0027 with default config"",""Process"":""reader"",""ProcessedText"":""creates buffer \u0027test-invalid-header\u0027 with default config"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process connects to buffer \u0027test-invalid-header\u0027"",""Process"":""writer"",""ProcessedText"":""connects to buffer \u0027test-invalid-header\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process writes frame with data \u0027test\u0027"",""Process"":""writer"",""ProcessedText"":""writes frame with data \u0027test\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the test corrupts frame header \u0027payload_size\u0027 to \u00270\u0027"",""Process"":""writer"",""ProcessedText"":""the test corrupts frame header \u0027payload_size\u0027 to \u00270\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027reader\u0027 process attempts to read frame"",""Process"":""reader"",""ProcessedText"":""attempts to read frame"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the read should fail with invalid frame size error"",""Process"":""reader"",""ProcessedText"":""the read should fail with invalid frame size error"",""Parameters"":{}}]}";
    private static readonly string Test_5_3_Reader_Death_During_Write_reader_csharp_writer_python_Json = @"{""TestId"":""csharp-python-test-5-3---reader-death-during-write"",""FeatureId"":5,""ScenarioName"":""Test 5.3 - Reader Death During Write"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""python""},""Background"":[{""Type"":""Given"",""Text"":""the test environment is initialized"",""Process"":null,""ProcessedText"":""the test environment is initialized"",""Parameters"":{}},{""Type"":""Given"",""Text"":""all processes are ready"",""Process"":null,""ProcessedText"":""all processes are ready"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the \u0027reader\u0027 process creates buffer \u0027test-reader-death\u0027 with metadata size \u00270\u0027 and payload size \u002710240\u0027"",""Process"":""reader"",""ProcessedText"":""creates buffer \u0027test-reader-death\u0027 with metadata size \u00270\u0027 and payload size \u002710240\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process connects to buffer \u0027test-reader-death\u0027"",""Process"":""writer"",""ProcessedText"":""connects to buffer \u0027test-reader-death\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process starts writing large frame of \u00278192\u0027 bytes"",""Process"":""writer"",""ProcessedText"":""starts writing large frame of \u00278192\u0027 bytes"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027reader\u0027 process crashes while write in progress"",""Process"":""reader"",""ProcessedText"":""crashes while write in progress"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process completes write operation"",""Process"":""writer"",""ProcessedText"":""completes write operation"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process attempts next operation"",""Process"":""writer"",""ProcessedText"":""attempts next operation"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the \u0027writer\u0027 process should detect reader death"",""Process"":""writer"",""ProcessedText"":""should detect reader death"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the \u0027writer\u0027 process should throw reader dead exception"",""Process"":""writer"",""ProcessedText"":""should throw reader dead exception"",""Parameters"":{}}]}";
    private static readonly string Test_5_5_Wrap_Around_With_Wasted_Space_reader_csharp_writer_python_Json = @"{""TestId"":""csharp-python-test-5-5---wrap-around-with-wasted-space"",""FeatureId"":5,""ScenarioName"":""Test 5.5 - Wrap-Around With Wasted Space"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""python""},""Background"":[{""Type"":""Given"",""Text"":""the test environment is initialized"",""Process"":null,""ProcessedText"":""the test environment is initialized"",""Parameters"":{}},{""Type"":""Given"",""Text"":""all processes are ready"",""Process"":null,""ProcessedText"":""all processes are ready"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the \u0027reader\u0027 process creates buffer \u0027test-waste\u0027 with metadata size \u00270\u0027 and payload size \u002710240\u0027"",""Process"":""reader"",""ProcessedText"":""creates buffer \u0027test-waste\u0027 with metadata size \u00270\u0027 and payload size \u002710240\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process connects to buffer \u0027test-waste\u0027"",""Process"":""writer"",""ProcessedText"":""connects to buffer \u0027test-waste\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""writes frame that leaves \u0027100\u0027 bytes at end with \u0027incremental\u0027 pattern"",""Process"":""writer"",""ProcessedText"":""writes frame that leaves \u0027100\u0027 bytes at end with \u0027incremental\u0027 pattern"",""Parameters"":{}},{""Type"":""When"",""Text"":""attempts to write \u0027200\u0027 byte frame with \u0027sequential\u0027 pattern"",""Process"":""writer"",""ProcessedText"":""attempts to write \u0027200\u0027 byte frame with \u0027sequential\u0027 pattern"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the \u0027writer\u0027 process should write wrap marker at current position"",""Process"":""writer"",""ProcessedText"":""should write wrap marker at current position"",""Parameters"":{}},{""Type"":""Then"",""Text"":""should see payload_free_bytes reduced by wasted space"",""Process"":""writer"",""ProcessedText"":""should see payload_free_bytes reduced by wasted space"",""Parameters"":{}},{""Type"":""Then"",""Text"":""frame should be written at buffer start"",""Process"":""writer"",""ProcessedText"":""frame should be written at buffer start"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027reader\u0027 process reads next frame"",""Process"":""reader"",""ProcessedText"":""reads next frame"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the \u0027reader\u0027 process should detect wrap marker"",""Process"":""reader"",""ProcessedText"":""should detect wrap marker"",""Parameters"":{}},{""Type"":""Then"",""Text"":""should jump to buffer start"",""Process"":""reader"",""ProcessedText"":""should jump to buffer start"",""Parameters"":{}},{""Type"":""Then"",""Text"":""should read \u0027200\u0027 byte frame successfully with \u0027sequential\u0027 pattern"",""Process"":""reader"",""ProcessedText"":""should read \u0027200\u0027 byte frame successfully with \u0027sequential\u0027 pattern"",""Parameters"":{}}]}";
    private static readonly string Test_5_7_Maximum_Frame_Size_reader_csharp_writer_python_Json = @"{""TestId"":""csharp-python-test-5-7---maximum-frame-size"",""FeatureId"":5,""ScenarioName"":""Test 5.7 - Maximum Frame Size"",""ScenarioDescription"":null,""Tags"":[],""Platforms"":{""reader"":""csharp"",""writer"":""python""},""Background"":[{""Type"":""Given"",""Text"":""the test environment is initialized"",""Process"":null,""ProcessedText"":""the test environment is initialized"",""Parameters"":{}},{""Type"":""Given"",""Text"":""all processes are ready"",""Process"":null,""ProcessedText"":""all processes are ready"",""Parameters"":{}}],""Steps"":[{""Type"":""Given"",""Text"":""the \u0027reader\u0027 process creates buffer \u0027test-max-frame\u0027 with metadata size \u00270\u0027 and payload size \u0027104857600\u0027"",""Process"":""reader"",""ProcessedText"":""creates buffer \u0027test-max-frame\u0027 with metadata size \u00270\u0027 and payload size \u0027104857600\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process connects to buffer \u0027test-max-frame\u0027"",""Process"":""writer"",""ProcessedText"":""connects to buffer \u0027test-max-frame\u0027"",""Parameters"":{}},{""Type"":""When"",""Text"":""writes frame matching exactly payload size minus header"",""Process"":""writer"",""ProcessedText"":""writes frame matching exactly payload size minus header"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the \u0027writer\u0027 process should verify frame was written successfully"",""Process"":""writer"",""ProcessedText"":""should verify frame was written successfully"",""Parameters"":{}},{""Type"":""When"",""Text"":""the \u0027writer\u0027 process attempts to write frame exceeding payload size"",""Process"":""writer"",""ProcessedText"":""attempts to write frame exceeding payload size"",""Parameters"":{}},{""Type"":""Then"",""Text"":""the \u0027writer\u0027 process write should be rejected with appropriate error"",""Process"":""writer"",""ProcessedText"":""write should be rejected with appropriate error"",""Parameters"":{}}]}";

    #endregion

    #region Scenarios Collection
    public static IEnumerable<ScenarioExecution> Scenarios => new[]
    {
        DeserializeScenarioStatic(Test_5_1_Corrupted_OIEB_Detection_reader_csharp_writer_python_Json),
        DeserializeScenarioStatic(Test_5_2_Invalid_Frame_Header_Detection_reader_csharp_writer_python_Json),
        DeserializeScenarioStatic(Test_5_3_Reader_Death_During_Write_reader_csharp_writer_python_Json),
        DeserializeScenarioStatic(Test_5_5_Wrap_Around_With_Wasted_Space_reader_csharp_writer_python_Json),
        DeserializeScenarioStatic(Test_5_7_Maximum_Frame_Size_reader_csharp_writer_python_Json)
    };
    #endregion

    #region Test Methods
    [Fact(DisplayName = "Test 5.1 - Corrupted OIEB Detection [reader=csharp, writer=python]")]
    [Trait("Scenario", "Test 5.1 - Corrupted OIEB Detection")]
    [Trait("Platform", "csharp/python")]
    [Trait("Uses", "csharp")]
    [Trait("Uses", "python")]
    [Trait("Feature", "05-CorruptionDetection")]    public async Task Test_5_1_Corrupted_OIEB_Detection_reader_csharp_writer_python()
    {
        var scenario = DeserializeScenario(Test_5_1_Corrupted_OIEB_Detection_reader_csharp_writer_python_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 5.2 - Invalid Frame Header Detection [reader=csharp, writer=python]")]
    [Trait("Scenario", "Test 5.2 - Invalid Frame Header Detection")]
    [Trait("Platform", "csharp/python")]
    [Trait("Uses", "csharp")]
    [Trait("Uses", "python")]
    [Trait("Feature", "05-CorruptionDetection")]    public async Task Test_5_2_Invalid_Frame_Header_Detection_reader_csharp_writer_python()
    {
        var scenario = DeserializeScenario(Test_5_2_Invalid_Frame_Header_Detection_reader_csharp_writer_python_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 5.3 - Reader Death During Write [reader=csharp, writer=python]")]
    [Trait("Scenario", "Test 5.3 - Reader Death During Write")]
    [Trait("Platform", "csharp/python")]
    [Trait("Uses", "csharp")]
    [Trait("Uses", "python")]
    [Trait("Feature", "05-CorruptionDetection")]    public async Task Test_5_3_Reader_Death_During_Write_reader_csharp_writer_python()
    {
        var scenario = DeserializeScenario(Test_5_3_Reader_Death_During_Write_reader_csharp_writer_python_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 5.5 - Wrap-Around With Wasted Space [reader=csharp, writer=python]")]
    [Trait("Scenario", "Test 5.5 - Wrap-Around With Wasted Space")]
    [Trait("Platform", "csharp/python")]
    [Trait("Uses", "csharp")]
    [Trait("Uses", "python")]
    [Trait("Feature", "05-CorruptionDetection")]    public async Task Test_5_5_Wrap_Around_With_Wasted_Space_reader_csharp_writer_python()
    {
        var scenario = DeserializeScenario(Test_5_5_Wrap_Around_With_Wasted_Space_reader_csharp_writer_python_Json);
        await ExecuteScenarioAsync(scenario);
    }

    [Fact(DisplayName = "Test 5.7 - Maximum Frame Size [reader=csharp, writer=python]")]
    [Trait("Scenario", "Test 5.7 - Maximum Frame Size")]
    [Trait("Platform", "csharp/python")]
    [Trait("Uses", "csharp")]
    [Trait("Uses", "python")]
    [Trait("Feature", "05-CorruptionDetection")]    public async Task Test_5_7_Maximum_Frame_Size_reader_csharp_writer_python()
    {
        var scenario = DeserializeScenario(Test_5_7_Maximum_Frame_Size_reader_csharp_writer_python_Json);
        await ExecuteScenarioAsync(scenario);
    }


    #endregion
}